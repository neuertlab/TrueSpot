# Cell Segmentation Module - Output File Descriptions
This page describes the various output files generated by the Cell Segmentation module.

[Back](../dochome.md)

## MAT Files
Files with the `.mat` extension are MATLAB data files. They are generally used to store variables/data from a workspace or program or whatnot on disc for use across sessions or systems. These files contain MATLAB data structures/variables as compressed binary data and cannot be read in a text editor. However, they are by design very easy to load and view in MATLAB. In the IDE GUI this is as simple as dragging and dropping the MAT file into the workspace panel on the right that lists environment variables. Programmatically, the built-in `load` and `save` functions are all that are needed to read and write these files.

TrueSpot outputs MAT files by default simply because they are smaller than text files with the same data and it makes parsing much easier for downstream modules. However, there are options for dumping output information to standard text tables as well.

## Current Standard Output
Cell segmentation results, including cell and nuclear masks, are written to a MAT file either called "${OUTPUT_DIR}/CellSeg_$(IMAGE_NAME).mat" or "${OUTPUT_PATH}" depending upon whether a file path or a directory was set for the `-outpath` parameter. This results file contains two structs: `cellSeg` and `nucleiSeg`. `cellSeg` records the parameters used for cell segmentation, the 2D cell mask (`cell_mask`), statistics on each cell identified (`cell_info`) and the composite plane used to conduct cell segmentation (`trans_plane`).
`nucleiSeg` splits all of its variables into two more structs: `params` and `results`. `params` records the nuclear segmentation parameters used. `results` includes the statistics, output masks, and some handy intermediates. `nuc_label` and `nuc_label_lo` are the labeled 2D masks akin to the cell mask. `nuc_label` is what is passed to the cell segmentation function. `lbl_lo`, `lbl_mid`, and `lbl_hi` are 3D boolean masks marking the location of nuclei in space. `nuc_vol` stores the calculated volume of each nucleus (at each of the three thresholds: lo, mid, and hi) and `nuc_int` stores the integrated intensity over the volumen of each nucleus (again, at each of the three thresholds).

### Optional outputs
The cell and  initial nuclear masks (`nuc_label`) can be rendered to TIF files for easy viewing, if requested using the `ocellmask` and `onucmask` options. The settings used for the run can also be dumped to a text file using the `osettings` and/or `dumpsummary` options. If explicit path is not provided, it will default to "${OUTPUT_DIR}/CSegSettings_$(IMAGE_NAME).txt"

## Legacy Output
The `savebk` option changes the organization of the output files to ensure compatibility with previous versions and the GUI version of the tool (ie. CellDissect). These files contain the same result data, but arranged into three MAT files instead of one. Additionally, the file name prefixes are fixed to `Lab_${IMAGE_NAME}.mat`, `nuclei_${IMAGE_NAME}.mat`, and `nuclei_TH_${IMAGE_NAME}.mat`.
The `Lab_` (short for "label") file contains the cell segmentation output. The `cells` variable contains the cell mask, and `CellInfo` contains the table of cell stats. `trans_plane` is also saved into this file.
The `nuclei_` file contains most of the nuclear segmentation results. `Label_hi`, `Label_low`, and `Label_mid` contain the 3D boolean masks. `Nuc_int` and `Nuc_vol` contain the volume and intensity calculations for each nucleus.
`nuclei_TH` contains the threshold value used for nuclear segmentation (if applicable, `dapi_threshold`) and the 2D cell labels as `dapi_label` and `dapi_label_low_1`.
